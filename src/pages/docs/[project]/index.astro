---
import { db } from "../../../db";
import { docs } from "../../../db/schema";
import { eq, and } from "drizzle-orm";

const { project } = Astro.params;

const firstDoc = await db
  .select({ id: docs.id })
  .from(docs)
  .where(and(eq(docs.project, project!), eq(docs.visible, true)))
  .orderBy(docs.sortOrder)
  .get();

if (firstDoc) {
  return Astro.redirect(`/docs/${project}/${firstDoc.id}`);
}

return Astro.redirect("/docs");
---