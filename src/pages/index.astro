---
import BaseLayout from "../layouts/BaseLayout.astro";
import { db } from "../db";
import { portfolio, posts, docs, settings } from "../db/schema";
import { count } from "drizzle-orm";

const portfolioRow = await db.select().from(portfolio).get();
const postCount = await db.select({ n: count() }).from(posts).get();
const docCount = await db.select({ n: count() }).from(docs).get();
const maintenanceRow = await db.select().from(settings).get();
---

<BaseLayout title="Gabriel — Portfolio">
  <div style="max-width: 1100px; width: 100%; margin: 0 auto; padding: 2rem 3rem;">
    <p style="color: var(--body); margin-bottom: 1rem;">Phase 3 — Layout + Nav OK</p>
    <ul style="color: var(--secondary); list-style: none;">
      <li>Portfolio: {portfolioRow ? "loaded" : "missing"}</li>
      <li>Posts: {postCount?.n ?? 0}</li>
      <li>Docs: {docCount?.n ?? 0}</li>
      <li>Maintenance: {maintenanceRow?.value ?? "N/A"}</li>
    </ul>
  </div>
</BaseLayout>
